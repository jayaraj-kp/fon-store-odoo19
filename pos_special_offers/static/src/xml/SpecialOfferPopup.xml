<?xml version="1.0" encoding="UTF-8"?>
<templates xml:space="preserve">
<t t-name="pos_special_offers.SpecialOfferPopup">
    <div class="sop-overlay">
        <div class="sop-popup">

            <div class="sop-header">
                <span>üéÅ Special Offers</span>
                <div style="display:flex;align-items:center;gap:10px;">
                    <button class="sop-refresh-btn" t-on-click="onRefresh" t-att-disabled="state.refreshing">
                        <t t-if="state.refreshing">‚Üª</t>
                        <t t-else="">‚Üª Refresh</t>
                    </button>
                    <span class="sop-close" t-on-click="props.close">‚úï</span>
                </div>
            </div>

            <div class="sop-body">

                <!-- COUPON SECTION -->
                <div class="sop-coupon-section">
                    <div class="sop-section-title">üè∑Ô∏è Apply Coupon Code</div>
                    <div class="sop-coupon-row">
                        <input type="text"
                            class="sop-coupon-input"
                            placeholder="Enter coupon code e.g. 50001"
                            t-att-value="state.couponInput"
                            t-on-input="onCouponInput"/>
                        <button class="sop-btn-apply-coupon" t-on-click="applyCoupon">Apply</button>
                    </div>
                </div>

                <!-- FLAT DISCOUNT OFFERS -->
                <div style="display:flex;align-items:center;justify-content:space-between;margin-top:16px;margin-bottom:10px;">
                    <div class="sop-section-title" style="margin:0;">üîñ Active Flat Discount Offers</div>
                    <span class="sop-count-badge"><t t-esc="activeOffers.length"/> offer(s)</span>
                </div>

                <t t-if="activeOffers.length === 0">
                    <div class="sop-empty">
                        No active flat discount offers found.<br/>
                        <small>Check that offers are Active and within the date range in POS ‚Üí Special Offers.</small>
                    </div>
                </t>

                <t t-foreach="activeOffers" t-as="offer" t-key="offer.id">
                    <div class="sop-offer-card">
                        <div class="sop-offer-info">
                            <div class="sop-offer-name"><t t-esc="offer.name"/></div>
                            <div class="sop-offer-meta">
                                <t t-if="offer.discount_type === 'percentage'">
                                    <span class="sop-badge sop-badge-pct"><t t-esc="offer.discount_value"/>% OFF</span>
                                </t>
                                <t t-else="">
                                    <span class="sop-badge sop-badge-fixed">Fixed: ‚Çπ<t t-esc="offer.discount_value"/></span>
                                </t>
                                <span class="sop-offer-dates"><t t-esc="offer.date_from"/> ‚Üí <t t-esc="offer.date_to"/></span>
                                <t t-if="offer.purchase_limit > 0">
                                    <span class="sop-offer-limit">Uses: <t t-esc="offer.usage_count"/>/<t t-esc="offer.purchase_limit"/></span>
                                </t>
                            </div>
                            <div class="sop-offer-scope">
                                <t t-if="offer.product_ids.length > 0">Selected products only</t>
                                <t t-elif="offer.category_ids.length > 0">Selected categories only</t>
                                <t t-else="">Applies to all products in order</t>
                            </div>
                        </div>
                        <button class="sop-btn-apply" t-on-click="() => this.applyOffer(offer)">
                            Apply
                        </button>
                    </div>
                </t>

                <!-- Status messages -->
                <t t-if="state.errorMsg">
                    <div class="sop-error" style="margin-top:12px;"><t t-esc="state.errorMsg"/></div>
                </t>
                <t t-if="state.appliedMsg">
                    <div class="sop-success" style="margin-top:12px;"><t t-esc="state.appliedMsg"/></div>
                </t>

            </div>

            <div class="sop-footer">
                <button class="sop-btn-cancel" t-on-click="props.close">Close</button>
            </div>

        </div>
    </div>
</t>
</templates>
